<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>LoginPage</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-database.js"></script>
    <script src="static/fireBase.js"></script>
    <script src="static/login.js"></script>
    
    
    
</head>
<body>
    <h1>This is login page</h1>
    <style>
        img{
            height: 200px;
            width: 200px;
            border: 2px solid black;
        }
    </style>
    Image Name <input id="uploaded_img_name" type="text"> <br>
    <img id="uploaded_img"> <label id="UpProgress"></label> <br>

    <button id="select">Select Image</button>
    <button id="upload">Upload Image</button>
    <button id="retrieve">Retrieve Image</button>

    <button onclick="signOut()" id="signOut"> Sign Out </button>

    <script>
        var files = [];
        var reader;
        document.getElementById("select").onclick = function(e) {

            var input = document.createElement('input');
            input.type = 'file';

            input.onchange = e => {
                files = e.target.files;
                reader = new FileReader();
                reader.onload = function() {
                    document.getElementById("uploaded_img").src = reader.result;
                }
                reader.readAsDataURL(files[0]);
            }
            input.click();
        }

        document.getElementById("upload").onclick = function() {
            imgName = document.getElementById("uploaded_img_name").value;
            var uploadTask = storage.ref("users_content/" + imgName + ".png").put(files[0]);

            uploadTask.on('state_changed', function(snapshot){
                
                progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                document.getElementById('UpProgress').innerHTML = 'Upload' + progress + "%";
                
            },

            function(error) {
                alert('error in saving the image');
            },

            function() {
                uploadTask.snapshot.ref.getDownloadURL().then(function(url) {
                    imgUrl = url;

                    firebase.database().ref('content_files/'+imgName).set({
                        Name:imgName,
                        Link:imgUrl
                    });
                alert("Image added successfully");
                }
            );
            
        });
    }

    </script>

</body>
</html>